<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scrollspy Example</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <link rel="icon" type="image/png" sizes="64x64" href="../../res/prism_favicon_64.png">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* ABOUT ì„¹ì…˜ */
        .about-section {
            display: flex;
            align-items: flex-start;
            padding: 40px;
            flex-shrink: 0;
            max-width: 500px;

            position: fixed;
            /* í™”ë©´ ê¸°ì¤€ ê³ ì • */
            transform: translateY(50%);
            /* ì¤‘ì•™ ì •ë ¬ */


        }

        .about-text {
            writing-mode: vertical-rl;
            transform: rotate(180deg);
            font-size: 100px;
            font-weight: bold;
            margin-right: 30px;
        }

        .about-content {
            max-width: 600px;

        }

        .about-content h3 {
            margin-top: 10%;
        }


        .all-container-div {
            display: flex;
            flex-direction: row;
            /* ì˜¤ë¥¸ìª½ -> ì™¼ìª½ */
            justify-content: center;
            align-items: flex-start;
            flex-wrap: nowrap;
            gap: 20px;
            /* ì•„ì´í…œ ê°„ ê°„ê²© */
        }

        .about-div {
            flex: 30%;
        }

        .main-div,
        .scroll-div {
            flex: 35%;
            /* ê· ë“± ë°°ì¹˜ */
        }

        .scroll-div-child {
            position: fixed;
            /* í™”ë©´ ê¸°ì¤€ ê³ ì • */
            transform: translateY(100%);
            /* ì¤‘ì•™ ì •ë ¬ */
            width: 80%;
            /* í•„ìš”ì— ë”°ë¼ ë„ˆë¹„ ì¡°ì • */

        }

        .list-group-item {
            border-left: 1px solid transparent;
            border-right: 1px solid transparent;
            border-top: 1px solid black;
            border-bottom: 1px solid black;
            border-radius: 0 !important;
            /* ëª¨ë“  í•­ëª© ê¸°ë³¸ì ìœ¼ë¡œ ë„¤ëª¨ */

            font-size: 20px;

        }


        .main-div {
            display: flex;
            justify-content: center;
            /* ê°€ë¡œ ì¤‘ì•™ */
            align-items: center;
            /* ì„¸ë¡œ ì¤‘ì•™ */
            height: 100vh;
            /* í™”ë©´ ì „ì²´ ë†’ì´ ì„¤ì • */
        }



        .img-outside-div {
            /* í™”ë©´ ê¸°ì¤€ ê³ ì • */

            background-color: #fffde9;
            /* ì¤‘ì•™ ì •ë ¬ */

            height: 85vh;
            position: relative;

        }







        .img-div {
            position: relative;
            transform: translateY(10%);
            padding: 0 20px;
            padding-top: 30px;
        }

        .img-intro {
            position: relative;
            background-color: white;
            margin-top: 100px;
            margin: 60px 30px 30px 30px;
            height: 35vh;
        }

        .img-intro>ul>li {
            font-size: 20px;
            margin: 15px 0;
            padding: 3px 0;
        }




        /* ë°©ëª…ë¡ CSS */

        .comments {
            width: 500px;
            height: auto;
            margin: 0 auto;
            position: relative;
            left: -35px;
            margin-bottom: 100px;
        }

        .comments .inputs {
            width: 100%;
            height: auto;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: flex-start;
            gap: 10px;
            margin-bottom: 20px;
            color: #000;
        }

        .comments .inputs input,
        textarea {
            color: #111;
        }

        .comments .inputs .inputBox {
            width: 100%;
            color: black;
        }

        .comments .inputs textarea {
            width: 100%;
            height: 100px;
            resize: none;
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 10px;
            font-size: 14px;
            overflow: hidden;

        }

        .comments .inputs button {
            width: 100px;
            height: 40px;
            border: none;
            border-radius: 5px;
            background-color: #545454;
            color: #fff;
        }

        #showing {
            width: 100%;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: flex-start;
            gap: 10px;
        }

        #showing .comment_box {
            width: 100%;
            height: auto;
            background-color: #fff;
            border-radius: 5px;
            padding: 10px;
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            align-items: center;
            gap: 100px;
            padding: 20px;
            border: 1px solid black;
        }

        #showing .comment_box .comment_item {
            width: 70%;
            height: auto;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: flex-start;
            gap: 10px;
        }

        #showing .comment_box .button {
            width: 25%;
            min-width: 130px;
            display: flex;
            flex-direction: row;
            justify-content: flex-end;
            align-items: center;
        }

        #showing .comment_box .button button {
            min-width: 60px;
            height: 30px;
            border: none;
            border-radius: 5px;
            background-color: #545454;
            color: #fff;
            margin-left: 10px;
        }

        .posting-intro {
            margin-bottom: 30px;
        }

       
    </style>
    <script type="module">
        // Firebase SDK ë¼ì´ë¸ŒëŸ¬ë¦¬ ê°€ì ¸ì˜¤ê¸°
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
        import { collection, addDoc, serverTimestamp, query, orderBy, doc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
        import { getDocs } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";


        // Firebase êµ¬ì„± ì •ë³´ ì„¤ì •
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
            apiKey: "AIzaSyDEigBAYKdeVx7q7B7u5CS4bkkh6-2y_J4",
            authDomain: "sparta-bf5a2.firebaseapp.com",
            projectId: "sparta-bf5a2",
            storageBucket: "sparta-bf5a2.firebasestorage.app",
            messagingSenderId: "566331643385",
            appId: "1:566331643385:web:783f6ccd3b145a49dc1928",
            measurementId: "G-ZW4097G1W6"
        };

        // Firebase ì¸ìŠ¤í„´ìŠ¤ ì´ˆê¸°í™”
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);


        // ë“±ë¡ í´ë¦­ 
        $("#postingbtn").click(async function () {
            let name = $('#name').val();
            let content = $('#content').val();

            let doc = {
                'name': name,
                'content': content,
                createdAt: serverTimestamp()
            };
            await addDoc(collection(db, "postings"), doc);
            alert('ì €ì¥ ì™„ë£Œ!');
            window.location.reload();
        });


        // ìˆ˜ì • í´ë¦­
        $(document).on("click", ".modify", function () {
            const $commentBox = $(this).closest(".comment_box");
            const contentEl = $commentBox.find(".content");
            const originalText = contentEl.text();

            // ì´ë¯¸ textarea ìƒíƒœë©´ ì¤‘ë³µ í´ë¦­ ë°©ì§€
            if ($commentBox.find("textarea.edit-content").length > 0) return;

            // textareaë¡œ êµì²´
            const textarea = `<textarea class="edit-content" style="width: 100%; height: 100px;">${originalText}</textarea>`;
            contentEl.replaceWith(textarea);

            // ì €ì¥ ë²„íŠ¼ ìƒì„±
            const saveBtn = `<button class="save" type="button" data-id="${$(this).data("id")}">ì €ì¥</button>`;
            $(this).after(saveBtn);  // ìˆ˜ì • ë²„íŠ¼ ë’¤ì— ë¶™ì„
            $(this).hide(); // ìˆ˜ì • ë²„íŠ¼ ìˆ¨ê¸°ê¸°
        });
        

        // ì €ì¥ ë²„íŠ¼ í´ë¦­
        $(document).on("click", ".save", async function () {
            const docId = $(this).data("id");
            const $commentBox = $(this).closest(".comment_box");
            const newContent = $commentBox.find("textarea.edit-content").val();

            try {
                await updateDoc(doc(db, "postings", docId), {
                    content: newContent
                });

                alert("ìˆ˜ì • ì™„ë£Œ!");
                window.location.reload();
            } catch (error) {
                console.error("ìˆ˜ì • ì˜¤ë¥˜:", error);
                alert("ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
            }
        });


        // ì‚­ì œ í´ë¦­ ì´ë²¤íŠ¸ - ë™ì  ìš”ì†ŒëŠ” ì´ë²¤íŠ¸ ìœ„ì„ í•„ìˆ˜!
        $(document).on("click", ".delete", async function () {
            const docId = $(this).data("id");

            if (confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                try {
                    await deleteDoc(doc(db, "postings", docId));
                    alert("ì‚­ì œ ì™„ë£Œ!");
                    window.location.reload();
                } catch (error) {
                    console.error("ë¬¸ì„œ ì‚­ì œ ì˜¤ë¥˜:", error);
                }
            }
        });


        // ë°©ëª…ë¡ ë¶™ì´ê¸° ì½”ë“œ 
        const beforeDocs = collection(db, "postings");
        const q = query(beforeDocs, orderBy("createdAt", "desc"));
        let docs = await getDocs(q);
        docs.forEach((doc) => {
            let row = doc.data();

            let name = row['name'];
            let content = row['content'];
            let createdAt = row['createdAt'];
            let formattedDate = createdAt?.toDate().toLocaleString('ko-KR');

            let temp_html = `
            <div class="comment_box">
                <div class="comment_item">
                    <p class="name">${name}</p>
                    <em class="date">${formattedDate}</em>
                    <p class="content">${content}</p>
                </div>
                <div class="button">
                    <button class="modify" type="button" data-id="${doc.id}">ìˆ˜ì •</button>
                    <button class="delete" type="button" data-id="${doc.id}">ì‚­ì œ</button>
                </div>
            </div>`;

            $('#showing').append(temp_html);
        });

    </script>
</head>

<body>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <div class="full-frame">
        <div class="all-container-div">
            <div class="about-div">
                <!-- ì™¼ìª½ ABOUT ì„¹ì…˜ -->
                <div class="about-section">
                    <div class="about-text">ABOUT</div>
                    <div class="about-content">
                        <h3>Hello !<br /> My name is<br />
                            Choi Jungyoon </h3>
                    </div>
                </div>
            </div>

            <!-- ì¤‘ì•™ ë©”ì¸ ì„¹ì…˜ -->
            <div class="main-div">
                <div class="img-outside-div">
                    <div class="img-div">
                        <img src="../../res/cjy - img/selfie1.png" class="mx-auto d-block" alt="..." width="95%">
                    </div>

                    <div class="img-intro">
                        <ul>
                            <li>ì´ë¦„ : ìµœì •ìœ¤</li>
                            <li>ë‚˜ì´ : 27</li>
                            <li>MBTI : ISTP</li>
                            <li>ì¡¸ì—… : ìˆœì²œí–¥ëŒ€í•™êµ ì»´í“¨í„°ì†Œí”„íŠ¸ì›¨ì–´ê³µí•™ê³¼</li>
                            <li>ìŠ¤íŒŒë¥´íƒ€ì—ì„œì˜ ë§ˆìŒê°€ì§ : ë°±ë¬¸ì´ ë¶ˆì—¬ì¼íƒ€ !</li>
                        </ul>
                    </div>
                </div>
            </div>
            <!-- ì˜¤ë¥¸ìª½ ìŠ¤í¬ë¡¤ ì„¹ì…˜ -->
            <div class="scroll-div">
                <div class="scroll-div-child">

                    <div class="flex-grow-1 p-4">
                        <div class="row">
                            <div class="col-4">
                                <div id="list-example" class="list-group">
                                    <a class="list-group-item list-group-item-action"
                                        href="./jungyoon.html">Jungyoon</a>
                                    <a class="list-group-item list-group-item-action" href="./hobby.html">Hobby</a>
                                    <a class="list-group-item list-group-item-action" href="./hamster.html">My ğŸ¹</a>
                                    <a class="list-group-item list-group-item-action" href="./cat.html">Like ğŸˆ</a>
                                    <a class="list-group-item list-group-item-action" href="./song.html">Song ğŸ¶</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
    </div>

    <div class="comments">
        <div class="posting-intro">
            <h3>ë°©ëª…ë¡ì„ ì‘ì„±í•´ë³´ì„¸ìš” ! ğŸ¤“</h3>
        </div>
        <div class="inputs">
            <div class="inputBox">
                <em>ì´ë¦„ : </em>
                <input type="text" name="name" id="name" placeholder="ì´ë¦„">
            </div>
            <div class="inputBox">
                <textarea name="content" id="content" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
            </div>
            <button id="postingbtn" type="button" class="create">ë“±ë¡</button>
        </div>
        <div id="showing">

        </div>
    </div>
</body>

</html>